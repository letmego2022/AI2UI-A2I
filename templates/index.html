<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>AI2UIï¼šA2I</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
  <style>
    #main-image {
      max-width: 100%;
      border: 1px solid #ccc;
      max-height: 70vh;
      object-fit: contain;
    }
    #thumbnail-list {
      max-height: 80vh;
      overflow-y: auto;
    }
    .thumbnail-item {
      cursor: pointer;
      border: 2px solid transparent;
      transition: border-color 0.2s;
      max-width: 100%;
      height: 80px;
      object-fit: cover;
    }
    .thumbnail-item:hover {
      border-color: #0d6efd;
    }
    .thumbnail-item.active {
      border-color: #ffc107;
    }
    .status-message {
      margin-bottom: 10px;
    }
    .control-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: end;
    }
    .url-input-group {
      display: flex;
      gap: 10px;
      align-items: end;
    }
    .card-body p, .card-body li {
      margin-bottom: 4px;
      line-height: 1.3;
    }

  </style>
</head>
<body class="bg-light">
  <div class="container py-4">
    <h1 class="mb-4">ğŸ§  AI2UIï¼šA2Iï¼ˆAI â†’ UI è‡ªåŠ¨åŒ–ç³»ç»Ÿï¼‰</h1>

    <!-- ğŸ“˜ ä½¿ç”¨è¯´æ˜ -->
    <div class="card mb-3 border-info p-2" style="font-size: 14px;">
      <div class="card-body py-2 px-3">
        <div class="row">
          <!-- å·¦ä¾§è¯´æ˜ -->
          <div class="col-md-5 d-flex flex-column justify-content-center">
            <h6 class="text-info mb-1">ğŸ“˜ ä½¿ç”¨è¯´æ˜</h6>
            <p class="mb-0">ç³»ç»Ÿé€šè¿‡ AI åˆ†ææˆªå›¾å¹¶è‡ªåŠ¨æ‰§è¡Œ UI æ“ä½œã€‚</p>
          </div>
          <!-- å³ä¾§åŠŸèƒ½ç‚¹ -->
          <div class="col-md-7">
            <ul class="mb-0 ps-3">
              <li><strong>æ”¯æŒè‡ªç„¶è¯­è¨€è¾“å…¥</strong>ï¼Œå¦‚ï¼šã€Œç‚¹å‡»ç™»å½•æŒ‰é’®å¹¶è¾“å…¥å¯†ç ã€</li>
              <li><strong>è‡ªåŠ¨æ¨ç†ç‚¹å‡»ã€è¾“å…¥ã€æ‹–åŠ¨</strong> ç­‰æ“ä½œ</li>
              <li><strong>å¤šæ­¥ä»»åŠ¡æ‰§è¡Œ</strong>ï¼Œå¹¶è‡ªåŠ¨æˆªå›¾è¿½è¸ª</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    

    <!-- æµè§ˆå™¨æ§åˆ¶åŒºåŸŸ -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">ğŸŒ æµè§ˆå™¨æ§åˆ¶</h5>
        <div class="url-input-group mb-3">
          <div class="flex-grow-1">
            <label for="browser-url" class="form-label">è¯·è¾“å…¥ç½‘ç«™URLï¼š</label>
            <input
              type="url"
              class="form-control"
              id="browser-url"
              placeholder="ä¾‹å¦‚ï¼šhttps://www.example.com"
              value="https://cn.bing.com"
            />
          </div>
          <div>
            <label class="form-label">&nbsp;</label>
            <div class="d-flex gap-2">
              <button id="start-browser" class="btn btn-success">ğŸš€ å¯åŠ¨æµè§ˆå™¨</button>
              <button id="close-browser" class="btn btn-danger">â¹ï¸ å…³é—­æµè§ˆå™¨</button>
            </div>
          </div>
        </div>
        <div class="alert alert-info" id="browser-status">
          <strong>æµè§ˆå™¨çŠ¶æ€ï¼š</strong>
          <span id="status-text">æœªå¯åŠ¨</span>
        </div>
      </div>
    </div>

    <!-- ä»»åŠ¡æ‰§è¡ŒåŒºåŸŸ -->
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">ğŸ¤– AIä»»åŠ¡æ‰§è¡Œ</h5>
        <form id="task-form" class="mb-3">
          <div class="mb-3">
            <label for="task" class="form-label">è¯·è¾“å…¥ä»»åŠ¡æè¿°ï¼š</label>
            <input
              type="text"
              class="form-control"
              id="task"
              name="task"
              placeholder="ä¾‹å¦‚ï¼šç‚¹å‡»æœç´¢æ¡†ï¼Œè¾“å…¥'AIè‡ªåŠ¨åŒ–'ï¼Œç„¶åç‚¹å‡»æœç´¢æŒ‰é’®"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary" id="start-btn" disabled>â–¶ï¸ å¼€å§‹æ‰§è¡Œä»»åŠ¡</button>
        </form>

        <div class="row">
          <!-- å·¦ä¾§ï¼šä¸»å›¾å±•ç¤ºåŒºåŸŸ -->
          <div class="col-md-9">
            <h6>æ‰§è¡Œç»“æœ</h6>
            <div id="main-display" class="mt-3 text-center">
              <img id="main-image" src="" alt="ä¸»å›¾å±•ç¤º" class="img-fluid" style="display:none;" />
              <div id="main-status" class="text-muted">è¯·å…ˆå¯åŠ¨æµè§ˆå™¨</div>
            </div>
          </div>

          <!-- å³ä¾§ï¼šç¼©ç•¥å›¾å¯¼èˆª -->
          <div class="col-md-3">
            <h6>æ­¥éª¤å¯¼èˆª</h6>
            <div id="thumbnail-list" class="d-flex flex-column gap-2"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <footer class="text-center text-muted mt-4 mb-2 small">
    AI2UIï¼šA2I Â© 2025 - Powered by GPT è‡ªåŠ¨åŒ–å¼•æ“
  </footer>
  
  <script>
    // åˆå§‹åŒ– SocketIO è¿æ¥
    const socket = io();
    
    // DOMå…ƒç´ 
    const browserUrlInput = document.getElementById("browser-url");
    const startBrowserBtn = document.getElementById("start-browser");
    const closeBrowserBtn = document.getElementById("close-browser");
    const taskForm = document.getElementById("task-form");
    const startTaskBtn = document.getElementById("start-btn");
    const mainImage = document.getElementById("main-image");
    const mainStatus = document.getElementById("main-status");
    const thumbnailList = document.getElementById("thumbnail-list");
    const statusText = document.getElementById("status-text");

    let currentThumbnails = [];
    let activeThumbnail = null;

    function showMainImage(src, statusText = '') {
      mainImage.src = src;
      mainImage.style.display = 'block';
      mainStatus.textContent = statusText || '';
    }

    function addThumbnail(step, substep, imgSrc, msg, isActive = false) {
      const thumbContainer = document.createElement("div");
      thumbContainer.className = "position-relative";
      
      const thumb = document.createElement("img");
      thumb.src = imgSrc;
      thumb.alt = msg || `æ­¥éª¤ ${step} å­æ­¥éª¤ ${substep}`;
      thumb.className = "thumbnail-item img-thumbnail";
      thumb.dataset.src = imgSrc;
      thumb.dataset.step = step;
      thumb.dataset.substep = substep;

      thumb.addEventListener("click", () => {
        showMainImage(imgSrc, msg || `æ­¥éª¤ ${step} - å­æ­¥éª¤ ${substep}`);
        document.querySelectorAll(".thumbnail-item").forEach(t => t.classList.remove("active"));
        thumb.classList.add("active");
        activeThumbnail = thumb;
      });

      thumbContainer.appendChild(thumb);
      
      const label = document.createElement("div");
      label.className = "position-absolute top-0 start-0 bg-primary text-white px-1 small";
      label.style.fontSize = "10px";
      label.textContent = step && substep ? `${step}-${substep}` : 'åˆå§‹';
      thumbContainer.appendChild(label);

      thumbnailList.appendChild(thumbContainer);
      currentThumbnails.push(thumb);

      if (isActive || currentThumbnails.length === 1) {
        showMainImage(imgSrc, msg);
        document.querySelectorAll(".thumbnail-item").forEach(t => t.classList.remove("active"));
        thumb.classList.add("active");
        activeThumbnail = thumb;
      }
    }

    function clearResults() {
      mainImage.style.display = 'none';
      mainStatus.textContent = "ç­‰å¾…ä»»åŠ¡æ‰§è¡Œ...";
      thumbnailList.innerHTML = '';
      currentThumbnails = [];
      activeThumbnail = null;
    }

    function addStatusMessage(message, type = 'info') {
      const alertDiv = document.createElement("div");
      alertDiv.className = `alert alert-${type} status-message mb-1`;
      alertDiv.textContent = message;
      mainStatus.appendChild(alertDiv);
      mainStatus.scrollTop = mainStatus.scrollHeight;
    }

    function updateBrowserStatus(status, type = 'secondary') {
      statusText.textContent = status;
      statusText.className = `alert-${type}`;
    }

    function enableTaskButton(enabled) {
      startTaskBtn.disabled = !enabled;
    }

    // SocketIO äº‹ä»¶ç›‘å¬
    socket.on('browser_started', function(data) {
      updateBrowserStatus(`è¿è¡Œä¸­ - ${data.url}`, 'success');
      addStatusMessage(`âœ… ${data.msg}`, 'success');
      enableTaskButton(true);
    });

    socket.on('browser_error', function(data) {
      updateBrowserStatus('å¯åŠ¨å¤±è´¥', 'danger');
      addStatusMessage(`âŒ ${data.msg}`, 'danger');
      enableTaskButton(false);
    });

    socket.on('browser_closed', function(data) {
      updateBrowserStatus('å·²å…³é—­', 'secondary');
      addStatusMessage(`â¹ï¸ ${data.msg}`, 'info');
      enableTaskButton(false); // ç¡®ä¿ä»»åŠ¡æŒ‰é’®è¢«ç¦ç”¨
      clearResults();
      mainStatus.textContent = "è¯·å…ˆå¯åŠ¨æµè§ˆå™¨";
      
      // *** å…³é”®ä¿®å¤ï¼šé‡æ–°å¯ç”¨å¯åŠ¨æµè§ˆå™¨æŒ‰é’® ***
      // å½“æµè§ˆå™¨æˆåŠŸå…³é—­åï¼Œç”¨æˆ·åº”è¯¥èƒ½å¤Ÿå†æ¬¡å¯åŠ¨å®ƒ
      startBrowserBtn.disabled = false; 
    });

    socket.on('browser_close_error', function(data) {
      addStatusMessage(`âŒ ${data.msg}`, 'danger');
    });

    socket.on('browser_status', function(data) {
      updateBrowserStatus(data.status, data.type || 'secondary');
      if (data.type === 'success') {
        enableTaskButton(true);
      } else {
        enableTaskButton(false);
      }
    });

    socket.on('screenshot_update', function(data) {
      addThumbnail(
        data.step || 0, 
        data.substep || 0, 
        data.img, 
        data.msg || 'æˆªå›¾æ›´æ–°',
        true
      );
    });

    socket.on('task_start', function(data) {
      clearResults();
      addStatusMessage(`â–¶ï¸ ${data.msg}`, 'info');
    });

    socket.on('step_start', function(data) {
      addStatusMessage(`â–¶ï¸ æ­¥éª¤ ${data.step} å¼€å§‹æ‰§è¡Œ`, 'info');
    });

    socket.on('task_done', function(data) {
      addStatusMessage(`âœ… ${data.msg}`, 'success');
      startTaskBtn.disabled = false;
    });

    socket.on('task_warning', function(data) {
      addStatusMessage(`âš ï¸ ${data.msg}`, 'warning');
      startTaskBtn.disabled = false;
    });

    socket.on('task_error', function(data) {
      addStatusMessage(`âŒ ${data.msg}`, 'danger');
      startTaskBtn.disabled = false;
    });

    // åŒæ—¶ï¼Œä¸ºäº†å¤„ç†å¯èƒ½çš„å¯åŠ¨å¤±è´¥æƒ…å†µï¼Œä¹Ÿæ›´æ–° 'browser_error' ç›‘å¬å™¨
    socket.on('browser_error', function(data) {
      updateBrowserStatus('å¯åŠ¨å¤±è´¥', 'danger');
      addStatusMessage(`âŒ ${data.msg}`, 'danger');
      enableTaskButton(false);
      
      // *** å…³é”®ä¿®å¤ï¼šå¦‚æœå¯åŠ¨å¤±è´¥ï¼Œä¹Ÿåº”è¯¥é‡æ–°å¯ç”¨å¯åŠ¨æŒ‰é’®ï¼Œè®©ç”¨æˆ·å¯ä»¥é‡è¯• ***
      startBrowserBtn.disabled = false; 
    });

    // å¯åŠ¨æµè§ˆå™¨äº‹ä»¶
    startBrowserBtn.addEventListener("click", function() {
      const url = browserUrlInput.value.trim();
      if (!url) {
        alert("è¯·è¾“å…¥URL");
        return;
      }

      startBrowserBtn.disabled = true;
      socket.emit('start_browser', {url: url});
    });

    // å…³é—­æµè§ˆå™¨äº‹ä»¶
    closeBrowserBtn.addEventListener("click", function() {
      if (!confirm("ç¡®å®šè¦å…³é—­æµè§ˆå™¨å—ï¼Ÿ")) return;
      socket.emit('close_browser');
    });

    // æ‰§è¡Œä»»åŠ¡äº‹ä»¶
    taskForm.addEventListener("submit", function(e) {
      e.preventDefault();
      const task = document.getElementById("task").value.trim();
      if (!task) return;

      startTaskBtn.disabled = true;
      socket.emit('run_task', {task: task});
    });

    // è¿æ¥çŠ¶æ€å¤„ç†
    socket.on('connect', function() {
      console.log('WebSocket è¿æ¥å·²å»ºç«‹');
      socket.emit('get_browser_status');
    });

    socket.on('disconnect', function() {
      console.log('WebSocket è¿æ¥å·²æ–­å¼€');
      updateBrowserStatus("è¿æ¥æ–­å¼€", 'danger');
      enableTaskButton(false);
    });
  </script>
</body>
</html>